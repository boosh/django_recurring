<div class="recurrence-set-widget" id="recurrence-set-widget-{{ widget.name }}">
    <input id="{{ widget.attrs.id }}" name="{{ widget.name }}" type="hidden"
           value="{{ widget.value|default_if_none:'' }}">
    <div id="recurrence-set-form-{{ widget.name }}">
    <!-- Ensure this div is not empty -->
    {% if not rule_formset and not date_formset %}
        <p>No rules or dates defined yet.</p>
    {% endif %}
        <h3>Rules</h3>
        {{ rule_formset.management_form }}
        <div id="rules-container">
            {% for form in rule_formset %}
            <div class="rule-form">
                {{ form.as_p }}
            </div>
            {% endfor %}
        </div>
        <button id="add-rule" type="button">Add Rule</button>

        <h3>Dates</h3>
        {{ date_formset.management_form }}
        <div id="dates-container">
            {% for form in date_formset %}
            <div class="date-form">
                {{ form.as_p }}
            </div>
            {% endfor %}
        </div>
        <button id="add-date" type="button">Add Date</button>
    </div>
    <div class="recurrence-set-text" id="recurrence-set-text-{{ widget.name }}"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        if (typeof initRecurrenceSetWidget === 'function') {
            try {
                initRecurrenceSetWidget('{{ widget.name }}', {{ recurrence_rules | safe }});
            } catch (error) {
                console.error('Error initializing RecurrenceSetWidget:', error);
            }
        } else {
            console.error('initRecurrenceSetWidget function is not defined');
        }
    });
</script>
